<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Validation que badetitou est l'auteur pour google -->
    <meta name="google-site-verification" content="v0CoNWgzPotXcXjDcB8Jtz_2WR-YY__FreCXk4diUOU" />

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Presentation of Benoît "badetitou" Verhaeghe">
    <link rel="icon" href="/img/logo/logo.png" type="image/x-icon">


    <title>Reporting sur la commande last - Benoît Verhaeghe</title>

    <link rel="canonical" href="http://badetitou.github.io/tps/HLIN303/tp7_py4/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css">

    <!-- Material design -->
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link
        href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
        rel='stylesheet' type='text/css'>

    <!-- My CSS -->
    <link rel="stylesheet" href="/css/my.css">

    <link type="application/atom+xml" rel="alternate" href="http://badetitou.github.io/feed.xml" title="Benoît Verhaeghe" />

</head>

<body>

    <header class="mdc-top-app-bar my-top-app-bar">
    <div class="mdc-top-app-bar__row">
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <button class="mdc-top-app-bar__navigation-icon mdc-icon-button material-icons" href="#">menu</button>
            <a class="mdc-top-app-bar__title my-nav-label" href="/" style="color: inherit;">Benoît Verhaeghe</a>
        </section>
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                    <a style="color: inherit;" class="mdc-button" href="/teaching/">
                        <div class="mdc-button__ripple"></div>
                        <span style="color: inherit;" class="mdc-button__label my-nav-label">Teaching</span>
                    </a>
				
                
                
                    <a style="color: inherit;" class="mdc-button" href="/post/">
                        <div class="mdc-button__ripple"></div>
                        <span style="color: inherit;" class="mdc-button__label my-nav-label">Posts</span>
                    </a>
				
                
                
                    <a style="color: inherit;" class="mdc-button" href="/projects/">
                        <div class="mdc-button__ripple"></div>
                        <span style="color: inherit;" class="mdc-button__label my-nav-label">Projects</span>
                    </a>
				
                
                
                    <a style="color: inherit;" class="mdc-button" href="/research/">
                        <div class="mdc-button__ripple"></div>
                        <span style="color: inherit;" class="mdc-button__label my-nav-label">Research</span>
                    </a>
				
                
        </section>
    </div>
</header>

<aside class="mdc-drawer mdc-drawer--modal">
<div class="mdc-drawer__content">
    <nav class="mdc-list">
        
                
                
            
        
                
                
            
        
                
                
            
        
                
                
            
        
                
                
            
        
                
                
            
        
                
                
            
        
        
                
                
            
        
                
                    <a class="mdc-list-item" href="/teaching/" aria-current="page" tabindex="0">
                        <span class="mdc-list-item__ripple"></span>
                        <span class="mdc-list-item__text my-nav-label">Teaching</span>
                    </a>
				
            
        
                
                    <a class="mdc-list-item" href="/post/" aria-current="page" tabindex="0">
                        <span class="mdc-list-item__ripple"></span>
                        <span class="mdc-list-item__text my-nav-label">Posts</span>
                    </a>
				
            
        
                
                    <a class="mdc-list-item" href="/projects/" aria-current="page" tabindex="0">
                        <span class="mdc-list-item__ripple"></span>
                        <span class="mdc-list-item__text my-nav-label">Projects</span>
                    </a>
				
            
        
                
                    <a class="mdc-list-item" href="/research/" aria-current="page" tabindex="0">
                        <span class="mdc-list-item__ripple"></span>
                        <span class="mdc-list-item__text my-nav-label">Research</span>
                    </a>
				
            
        
        
        
        
  
    </nav>
</div>
</aside>

<div class="mdc-drawer-scrim"></div>




    <!-- Post Header -->
<header class="intro-header"
    style="background-image: url('/img/bg/keyboard.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Reporting sur la commande last</h1>
                    
                    <h2 class="subheading">Python - TP4</h2>
                    
                    <span class="meta">Posted by
                        Benoît "badetitou" Verhaeghe on
                        December 2, 2019</span>
                    <span class="post-meta">
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell--span-2"></div>
        <div class="mdc-layout-grid__cell--span-8">

            <h2 id="reporting-sur-la-commande-last">Reporting sur la commande last</h2>

<h3 id="sujet">Sujet</h3>

<p>En utilisant la commande last (ou en utilisant un fichier simulant le résultat de cette commande sur un poste de travail très fréquenté), écrire un script python qui liste les jours de connexion des utilisateurs qui ont fréquenté cette machine (en sachant que vous désirez surveiller les (mauvaises) fréquentations de celle-ci).</p>

<p>Réalisez ce programme en quatre étapes (qui se complèteront progressivement) :</p>

<ul>
  <li>Pour information, exécutez dans le script la commande last et affichez son résultat dans le terminal</li>
  <li>Récupérez maintenant le résultat de cette commande dans votre script. Mettez en place progressivement l’expression
régulière qui extrait :
    <ul>
      <li>le login</li>
      <li>le nom du mois et le numéro du jour dans le mois (la date)</li>
      <li>le nombre d’heures</li>
      <li>le nombre de minutes</li>
    </ul>
  </li>
  <li>et affichez ces informations</li>
  <li>Affichez :
    <ul>
      <li>le nombre de connexions par login (via un dictionnaire)</li>
      <li>le nombre de connexions et le temps de connexions (en minutes) par login (via un dictionnaire de listes)</li>
      <li>puis par login et par date (via un dictionnaires de dictionnaires de listes)</li>
      <li>Suivant des paramètres indiquant un nombre maximal de connexions et/ou un temps de connexion cumulé maximal, affichez des alertes !</li>
    </ul>
  </li>
</ul>

<h4 id="correction">Correction</h4>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">re</span>


<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">'r'</span><span class="p">)</span>
<span class="n">nbConnection</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">Counter</span><span class="p">()</span>
<span class="n">connectEtTemps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">loginAndDate</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>


<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"^\S* "</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"username: "</span><span class="p">,</span> <span class="n">username</span><span class="p">.</span><span class="n">group</span><span class="p">())</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">username</span><span class="p">.</span><span class="n">group</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">" [A-Z][a-z][a-z] ([0-9]| )[0-9]"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"date: "</span><span class="p">,</span> <span class="n">date</span><span class="p">.</span><span class="n">group</span><span class="p">())</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="p">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">nbHeure</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"\([0-9][0-9]"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbHeure</span><span class="p">:</span>
        <span class="n">nbHeure</span> <span class="o">=</span> <span class="n">nbHeure</span><span class="p">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"nbHeure: "</span><span class="p">,</span> <span class="n">nbHeure</span><span class="p">)</span>
    <span class="n">nbMinute</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"[0-9][0-9]\)"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">nbMinute</span> <span class="o">=</span> <span class="n">nbMinute</span><span class="p">.</span><span class="n">group</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"nbMinute: "</span><span class="p">,</span> <span class="n">nbMinute</span><span class="p">)</span>

    <span class="c1"># le nombre de connexions par login (via un dictionnaire)
</span>
    <span class="n">nbConnection</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">connectEtTemps</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">connectEtTemps</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="c1"># le nombre de connexions et le temps de connexions (en minutes) par login (via un dictionnaire de listes)
</span>
    <span class="k">if</span> <span class="n">nbHeure</span> <span class="ow">and</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">connectEtTemps</span><span class="p">[</span><span class="n">username</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbHeure</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbMinute</span><span class="p">))</span>

    <span class="c1"># puis par login et par date (via un dictionnaires de dictionnaires de listes)
</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">].</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nbHeure</span> <span class="ow">and</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="n">date</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbHeure</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbMinute</span><span class="p">))</span>


<span class="c1"># print("nbConnections: ", nbConnection)
</span>
<span class="c1"># print("connectEtTemps: ", connectEtTemps)
</span>
<span class="c1"># print("loginAndDate: ", loginAndDate)
</span>

<span class="c1"># affichage avancé pour login and date
</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">" s'est connecté les: "</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">v2</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="s">" durant"</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span> <span class="s">"min ; "</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</code></pre></div></div>


        </div>
    </div>
</article>

<hr>

    <!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="https://twitter.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://orcid.org/0000-0002-4588-2698">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-orcid fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.linkedin.com/in/benoitverhaeghe">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:badetitou@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; badetitou 2020</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js"></script>

<script src="/js/my-drawer.js"></script>


</body>

</html>
